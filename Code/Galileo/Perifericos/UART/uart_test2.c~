#include "uart_robocol.h"
#define BAUDRATE B115200

volatile uint8_t wait_flag=TRUE;
void sig_handler(int status);   /* definition of signal handler */

int main(int argc, char const *argv[]){
	char buf_rx[2];
	struct termios termios_p;
	termios_p.c_cflag = BAUDRATE | CS8 | CLOCAL | CREAD ;
	termios_p.c_iflag = ICRNL;
	termios_p.c_oflag = 0;
	termios_p.c_lflag = 0;
	termios_p.c_cc[VMIN]=1;
	termios_p.c_cc[VTIME]=0;
	uart_open("/dev/ttyS0",&termios_p,sig_handler);
	while(1){
		if (wait_flag==FALSE) {
			printf("Received\n");

			if((uart_read(buf_rx,2))<0){
				perror("Error en lectura");
				exit(1);
			}
			printf("%s\n",buf_rx);

		wait_flag = TRUE;      /* wait for new input */
		}
	}
/*TODO : Include write and read in this test, prove compilation*/
	return 0;
}

void sig_handler(int status)
{
	wait_flag = FALSE;
}
